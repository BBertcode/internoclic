<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>InternoClic</title>
    <link href="style.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Pixelify+Sans:wght@400..700&family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">

    <!-- IMPORTANT pour afficher les \n -->
    <style>
        #cp-aza {
            white-space: pre-line;
        }
    </style>
</head>

<body>
<header>
    <a href="index.html">
        <img src="Images/logo3.png" alt="logo InternoClic"/>  
    </a>
    <h1>InternoClic</h1>
</header>

<main class="ordo_liste">
    <h1>Azathioprine</h1>

    <div class="ordo1">
        <h3 class="titre-ordo">Ordonnance Azathioprine</h3>

        <!-- VARIABLES NON COPIÉES -->
        <div class="ordo2 no-copy" style="margin-bottom:12px; display:flex; gap:24px; align-items:center;">
            <div>
                <label for="poids-kg"><strong>Poids (kg) :</strong></label>
                <input id="poids-kg" type="number" min="10" max="250" step="0.1"
                       placeholder="ex : 70" style="margin-left:8px; width:90px;">
            </div>

            <div>
                <label for="tpmt-status"><strong>Génotypage TPMT :</strong></label>
                <select id="tpmt-status" style="margin-left:8px;">
                    <option value="normal" selected>Normal</option>
                    <option value="reduced">Inconnu ou intermédiaire</option>
                </select>
            </div>
        </div>

        <!-- TEXTE COPIABLE -->
        <p class="ordo2" id="ordo-aza">
            <span id="premiere-ligne">AZATHIOPRINE comprimé :</span><br>
            <span id="cp-aza"></span>
        </p>

        <button class="copy-btn">Copier</button>
    </div>
</main>

<footer>
    <a href="index.html">Page d'accueil</a>
</footer>

<script src="script.js"></script>

<script>
    function ceilToNext25(x) {
        return Math.ceil(x / 25) * 25;
    }

    function formatComprimésOptimisé(doseMg) {
        const n50 = Math.floor(doseMg / 50);
        const reste = doseMg % 50;
        const n25 = reste === 25 ? 1 : 0;

        const parts = [];
        if (n50 > 0) parts.push(`${n50} ${n50 === 1 ? "comprimé" : "comprimés"} de 50 mg`);
        if (n25 > 0) parts.push(`1 comprimé de 25 mg`);

        return parts.join(" + ");
    }

    function computeDoseAzathioprine(poidsKg, tpmtStatus) {
        let dose = ceilToNext25(poidsKg * 2);
        dose = Math.min(dose, 200);

        if (tpmtStatus === "reduced") {
            dose = ceilToNext25(dose / 2);
            dose = Math.min(dose, 100);
        }
        return dose;
    }

    function updateAzathioprineDose() {
        const poidsStr = document.getElementById("poids-kg").value.replace(",", ".");
        const poids = parseFloat(poidsStr);
        const tpmtStatus = document.getElementById("tpmt-status").value;
        const cpSpan = document.getElementById("cp-aza");

        if (!poids || poids <= 0) {
            cpSpan.textContent = "";
            return;
        }

        const dose = computeDoseAzathioprine(poids, tpmtStatus);
        const comp = formatComprimésOptimisé(dose);

        cpSpan.textContent =
            `- ${dose} mg le matin soit ${comp}.\n` +
            `- Ne pas associer à de l'allopurinol (Zyloric) ou du fébuxostat (Adénuric).`;
    }

    document.getElementById("poids-kg").addEventListener("input", updateAzathioprineDose);
    document.getElementById("tpmt-status").addEventListener("change", updateAzathioprineDose);

    updateAzathioprineDose();
</script>
</body>
</html>
